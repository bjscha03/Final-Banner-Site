<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            border: 1px solid #ccc;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .result {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Pricing Calculation Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Basic Calculation (48" x 24", 13oz, qty 1)</h2>
        <div id="test1-result" class="result">Running test...</div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Large Banner (96" x 48", 15oz, qty 2)</h2>
        <div id="test2-result" class="result">Running test...</div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Small Banner (12" x 12", 18oz, qty 1)</h2>
        <div id="test3-result" class="result">Running test...</div>
    </div>

    <script>
        // Pricing constants
        const PRICE_PER_SQFT = {
            '13oz': 4.5,
            '15oz': 6.0,
            '18oz': 7.5,
            'mesh': 6.0
        };
        const TAX_RATE = 0.06;
        
        // Feature flags (from .env)
        const FEATURE_FLAGS = {
            freeShipping: true,
            minOrderFloor: true,
            minOrderCents: 2000 // $20.00
        };

        function inchesToSqFt(widthIn, heightIn) {
            return (widthIn * heightIn) / 144;
        }

        function calcTotals(widthIn, heightIn, qty, material) {
            const area = inchesToSqFt(widthIn, heightIn);
            const unit = area * PRICE_PER_SQFT[material];
            const materialTotal = unit * qty;
            
            // Apply minimum order floor if enabled
            let adjustedSubtotal = materialTotal;
            let minOrderAdjustment = 0;
            
            if (FEATURE_FLAGS.minOrderFloor) {
                const minOrderDollars = FEATURE_FLAGS.minOrderCents / 100;
                if (materialTotal < minOrderDollars) {
                    minOrderAdjustment = minOrderDollars - materialTotal;
                    adjustedSubtotal = minOrderDollars;
                }
            }
            
            const tax = adjustedSubtotal * TAX_RATE;
            const totalWithTax = adjustedSubtotal + tax;

            return {
                area,
                unit,
                materialTotal,
                adjustedSubtotal,
                minOrderAdjustment,
                tax,
                totalWithTax
            };
        }

        function formatCurrency(amount) {
            return amount.toLocaleString('en-US', {
                style: 'currency',
                currency: 'USD',
                maximumFractionDigits: 2
            });
        }

        function runTest(testId, widthIn, heightIn, qty, material, expectedTotal) {
            const result = calcTotals(widthIn, heightIn, qty, material);
            const resultElement = document.getElementById(testId + '-result');
            
            const isPass = Math.abs(result.totalWithTax - expectedTotal) < 0.01;
            
            resultElement.innerHTML = `
                <strong>Dimensions:</strong> ${widthIn}" Ã— ${heightIn}" (${result.area.toFixed(2)} sq ft)<br>
                <strong>Material:</strong> ${material} (${formatCurrency(PRICE_PER_SQFT[material])}/sq ft)<br>
                <strong>Quantity:</strong> ${qty}<br>
                <strong>Base Cost:</strong> ${formatCurrency(result.materialTotal)}<br>
                <strong>Adjusted Subtotal:</strong> ${formatCurrency(result.adjustedSubtotal)}<br>
                ${result.minOrderAdjustment > 0 ? `<strong>Min Order Adjustment:</strong> ${formatCurrency(result.minOrderAdjustment)}<br>` : ''}
                <strong>Tax (6%):</strong> ${formatCurrency(result.tax)}<br>
                <strong>Total:</strong> ${formatCurrency(result.totalWithTax)}<br>
                <strong>Expected:</strong> ${formatCurrency(expectedTotal)}<br>
                <strong>Status:</strong> ${isPass ? 'PASS' : 'FAIL'}
            `;
            
            resultElement.className = 'result ' + (isPass ? 'pass' : 'fail');
        }

        // Run tests
        setTimeout(() => {
            // Test 1: 48" x 24", 13oz, qty 1 - should be $21.20 with min order floor
            runTest('test1', 48, 24, 1, '13oz', 21.20);
            
            // Test 2: 96" x 48", 15oz, qty 2 - should be much higher, no min order adjustment
            runTest('test2', 96, 48, 2, '15oz', 508.32); // 32 sq ft * $6 * 2 = $384 + tax = $407.04
            
            // Test 3: 12" x 12", 18oz, qty 1 - should hit min order floor
            runTest('test3', 12, 12, 1, '18oz', 21.20);
        }, 100);
    </script>
</body>
</html>
