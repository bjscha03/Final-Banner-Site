<!DOCTYPE html>
<html>
<head>
    <title>Debug Orders Issue</title>
</head>
<body>
    <h1>Debug Orders Issue</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            console.log(message);
            output.innerHTML += '<p>' + JSON.stringify(message, null, 2) + '</p>';
        }
        
        // Check localStorage state
        log('=== DEBUGGING ORDERS ISSUE ===');
        
        // Check current user
        const currentUser = localStorage.getItem('banners_current_user');
        log('Current user in localStorage:');
        log(currentUser ? JSON.parse(currentUser) : 'NO USER FOUND');
        
        // Check orders
        const orders = localStorage.getItem('banners_orders');
        log('Orders in localStorage:');
        log(orders ? JSON.parse(orders) : 'NO ORDERS FOUND');
        
        // Simulate sign in
        log('=== SIMULATING SIGN IN ===');
        const testUser = {
            id: 'dev_user_123',
            email: 'test@example.com',
            is_admin: false
        };
        localStorage.setItem('banners_current_user', JSON.stringify(testUser));
        log('Set test user:', testUser);
        
        // Clear orders to trigger sample data creation
        localStorage.removeItem('banners_orders');
        log('Cleared orders to trigger sample data creation');
        
        // Check what happens when we try to get orders
        log('=== CHECKING SAMPLE DATA CREATION ===');
        
        // Simulate the getStoredOrders function logic
        const stored = localStorage.getItem('banners_orders');
        const ordersArray = stored ? JSON.parse(stored) : [];
        
        if (ordersArray.length === 0) {
            log('No orders found, should create sample data...');
            
            // Get current user from localStorage to match sample orders
            const currentUserStr = localStorage.getItem('banners_current_user');
            const currentUserObj = currentUserStr ? JSON.parse(currentUserStr) : null;
            const sampleUserId = currentUserObj?.id || 'dev_user_123';
            
            log('Sample user ID will be:', sampleUserId);
            
            const sampleOrders = [
                {
                    id: '#MF7Q79BQ',
                    user_id: sampleUserId,
                    status: 'paid',
                    subtotal_cents: 3600,
                    tax_cents: 216,
                    total_cents: 3816,
                    currency: 'usd',
                    created_at: new Date().toISOString(),
                    items: [{
                        width_in: 48,
                        height_in: 24,
                        quantity: 1,
                        material: '13oz',
                        area_sqft: 8,
                        unit_price_cents: 3600,
                        line_total_cents: 3600,
                        grommets: 'every-2-3ft',
                        rope_feet: 0,
                        file_key: 'uploads/banner-design.jpg'
                    }],
                    tracking_number: null,
                    tracking_carrier: null
                }
            ];
            
            localStorage.setItem('banners_orders', JSON.stringify(sampleOrders));
            log('Created sample orders:', sampleOrders);
        }
        
        // Now check final state
        log('=== FINAL STATE ===');
        const finalUser = localStorage.getItem('banners_current_user');
        const finalOrders = localStorage.getItem('banners_orders');
        
        log('Final user:', finalUser ? JSON.parse(finalUser) : 'NO USER');
        log('Final orders:', finalOrders ? JSON.parse(finalOrders) : 'NO ORDERS');
        
        // Test filtering
        if (finalUser && finalOrders) {
            const user = JSON.parse(finalUser);
            const orders = JSON.parse(finalOrders);
            const userOrders = orders.filter(order => order.user_id === user.id);
            log('Filtered orders for user ' + user.id + ':', userOrders);
        }
    </script>
</body>
</html>
